//Raspberry Pi Interface with Ultrasonic Sensor - Program 1
import RPi.GPIO as GPIO
import time
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)
TRIG = 20
ECHO = 21
GPIO.setup(TRIG, GPIO.OUT)
GPIO.setup(ECHO, GPIO.IN)
try:
print("Press Ctrl+C to stop\n")
while True:
# Send trigger pulse
GPIO.output(TRIG, False)
time.sleep(0.0002)
GPIO.output(TRIG, True)
time.sleep(0.00001)
GPIO.output(TRIG, False)
# Capture echo times
while GPIO.input(ECHO) == 0:
start = time.time()
while GPIO.input(ECHO) == 1:
end = time.time()
# Calculate distance in cm
distance = (end - start) * 34300 / 2
# Use .format() for printing
print("Distance = {:.1f} cm".format(distance))
time.sleep(0.5)
except KeyboardInterrupt:
print("\nMeasurement stopped by user.")
GPIO.cleanup()

//IoT Data Processing with Raspberry Pi Pico W + HC-SR04 Ultrasonic Sensor + ThingSpeak - Program 2
import network
import urequests
import time
import machine
ssid = "Wokwi-GUEST"
password = ""
server = "api.thingspeak.com"
channel_id = 1234567
write_api_key = "XXXXXXXXXXXXXXXX"
trigger_pin = machine.Pin(15, machine.Pin.OUT)
echo_pin = machine.Pin(14, machine.Pin.IN)
led_alert_pin = machine.Pin(13, machine.Pin.OUT)
DISTANCE_CLOSE_THRESHOLD = 10.0
def connect_wifi():
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    wlan.connect(ssid, password)
    print("Connecting to WiFi...")
    while not wlan.isconnected():
        time.sleep(0.5)
        print(".")
    print("WiFi connected")
    print("IP address:", wlan.ifconfig()[0])
def measure_distance():
    trigger_pin.off()
    time.sleep_us(2)
    trigger_pin.on()
    time.sleep_us(10)
    trigger_pin.off()
    while echo_pin.value() == 0:
        signal_off = time.ticks_us()
    while echo_pin.value() == 1:
        signal_on = time.ticks_us()
    time_passed = signal_on - signal_off
    distance = (time_passed * 0.0343) / 2
    return distance
connect_wifi()
last_send = 0
while True:
    if time.time() - last_send < 20:
        time.sleep(1)
        continue
    last_send = time.time()
    distance = measure_distance()
    print("Distance:", round(distance, 1), "cm")
    alert = 0
    alert_msg = "Normal"
    led_alert_pin.off()
    if distance < DISTANCE_CLOSE_THRESHOLD:
        alert = 1
        alert_msg = "OBJECT TOO CLOSE"
        led_alert_pin.on()
    print("Alert:", alert, alert_msg)
    url = "https://{}/update?api_key={}&field1={:.1f}&field2={}".format(
        server, write_api_key, distance, alert
    )
    try:
        response = urequests.get(url)
        if response.status_code == 200:
            print("Data sent successfully!")
        response.close()
    except Exception as e:
        print("HTTP request failed:", e)
    time.sleep(1)
